# Á¨¨‰∏ÄÈÉ®ÂàÜ ÁÆÄ‰ªãÂíåTCP/IP

## Á¨¨‰∫åÁ´† ‰º†ËæìÂ±ÇÔºöTCP„ÄÅUDP Âíå SCTP

### 2.1 Ê¶ÇËø∞

Êú¨Á´†ÁöÑÁÑ¶ÁÇπËØïËØï‰º†ËæìÂ±ÇÔºåÂåÖÊã¨TCP„ÄÅUDPÂíåSCTP„ÄÇÁªùÂ§ßÂ§öÊï∞ÁΩëÁªúÂ∫îÁî®‰ΩøÁî®ÁöÑÈÉΩÊòØTCPÂíåUDP„ÄÇ

#### UDPÔºàUser Datagram ProtocolÔºâ

**üìå Ê¶ÇÂøµ**

UDP ÊòØ**Èù¢ÂêëÊó†ËøûÊé•**„ÄÅ**‰∏çÂèØÈù†**„ÄÅ**Â∞ΩÂäõËÄå‰∏∫ÔºàBest-EffortÔºâ**ÁöÑ‰º†ËæìÂ±ÇÂçèËÆÆ„ÄÇ
 ÁâπÁÇπÔºöÊó†ËøûÊé•„ÄÅÊó†Á°ÆËÆ§„ÄÅÊó†Èáç‰º†„ÄÅÊó†ÊµÅÊéß„ÄÅÊó†Êã•Â°ûÊéßÂà∂ ‚Üí **ÊûÅÂø´**„ÄÇ

**üìå Â∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ**

- ÂÆûÊó∂ÊÄßË¶ÅÊ±ÇÈ´òÔºö
  - **Èü≥ËßÜÈ¢ëÊµÅÂ™í‰ΩìÔºàVoIP, WebRTCÔºâ**
  - **Âú®Á∫øÊ∏∏Êàè**
  - **Áõ¥Êí≠„ÄÅËßÜÈ¢ë‰ºöËÆÆ**
- ÂπøÊí≠„ÄÅÂ§öÊí≠
- ÁÆÄÂçïÊü•ËØ¢ÂûãÂçèËÆÆÔºàDNS„ÄÅSNMPÔºâ

**üìå ‰ºòÁÇπ**

- ÈÄüÂ∫¶Âø´„ÄÅÂª∂Ëøü‰Ωé
- Â§öÊí≠ÂíåÂπøÊí≠ÊîØÊåÅÂ•Ω
- ÂçèËÆÆÁÆÄÂçï„ÄÅÂºÄÈîÄÂ∞èÔºàÂ§¥ÈÉ®Âè™Êúâ8Â≠óËäÇÔºâ

**üìå Áº∫ÁÇπ**

- **‰∏ç‰øùËØÅÂèØÈù†ÊÄß**ÔºàÂèØËÉΩ‰∏¢ÂåÖ„ÄÅ‰π±Â∫èÔºâ
- **‰∏ç‰øùËØÅÈ°∫Â∫è**
- **Êó†Èáç‰º†Êú∫Âà∂**ÔºàÂ∫îÁî®Â±ÇÂøÖÈ°ªËá™Â∑±Â§ÑÁêÜÂèØÈù†ÊÄßÔºâ

------

####  TCPÔºàTransmission Control ProtocolÔºâ

**üìå Ê¶ÇÂøµ**

TCP ÊòØ**Èù¢ÂêëËøûÊé•**ÁöÑ„ÄÅ**ÂèØÈù†**ÁöÑ**Â≠óËäÇÊµÅ**ÂçèËÆÆ„ÄÇ
 Êèê‰æõÔºöÂèØÈù†‰º†Ëæì„ÄÅÈ°∫Â∫è‰º†Ëæì„ÄÅÊµÅÊéß„ÄÅÊã•Â°ûÊéßÂà∂„ÄÇ

**üìå Â∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ**

- ÈúÄË¶ÅÂèØÈù†‰∫§‰ªòÁöÑÂ∫îÁî®
  - **HTTP/HTTPSÔºàÁΩëÈ°µÔºâ**
  - **FTP Êñá‰ª∂‰º†Ëæì**
  - **SSH**
  - **SMTP ÈÇÆ‰ª∂‰º†Ëæì**

**üìå ‰ºòÁÇπ**

- **ÂèØÈù†ÊÄß‰øùËØÅ**ÔºàÁ°ÆËÆ§„ÄÅÈáç‰º†Ôºâ
- **È°∫Â∫è‰øùËØÅ**
- **ÊµÅÊéß+Êã•Â°ûÊéßÂà∂**
- Èù¢ÂêëÂ≠óËäÇÊµÅÔºåÂ∫îÁî®ÁºñÁ®ãÁÆÄÂçï

**üìå Áº∫ÁÇπ**

- ËøûÊé•Âª∫Á´ãÔºà‰∏âÊ¨°Êè°ÊâãÔºâÂíåÈáäÊîæÔºàÂõõÊ¨°Êå•ÊâãÔºâÂ∏¶Êù•ÂºÄÈîÄ
- ÈÅá‰∏¢ÂåÖÈáç‰º† ‚Üí **Âª∂ËøüÂ§ß**
- ÊúâÊã•Â°ûÊéßÂà∂ ‚Üí ÂêûÂêê‰ºöË¢´ÈôêÂà∂
- ‰∏çÈÄÇÂêàÂÆûÊó∂Â∫îÁî®ÔºàËØ≠Èü≥ËßÜÈ¢ëÔºâ

------

#### SCTPÔºàStream Control Transmission ProtocolÔºâ

**üìå Ê¶ÇÂøµ**

SCTP ÊòØ‰∏∫Áîµ‰ø°ÁΩëÁªúËÆæËÆ°ÁöÑ‰º†ËæìÂ±ÇÂçèËÆÆÔºåÁªìÂêà‰∫Ü **TCP ÁöÑÂèØÈù†ÊÄß** Âíå **UDP ÁöÑÂ§öÊµÅÁâπÊÄß**„ÄÇ
 ÁâπÁÇπÔºö

- **Â§öÊµÅÔºàmulti-streamÔºâ**ÔºöÂ§ö‰∏™Áã¨Á´ãÊµÅÔºå‰∫í‰∏çÂΩ±Âìç
- **Â§öÂÆø‰∏ªÔºàmulti-homingÔºâ**ÔºöÂ§öÁΩëÂè£Â§öIPÔºåÂÖ∑ÊúâË∑ØÂæÑÂÜó‰Ωô
- Èù¢ÂêëÊ∂àÊÅØÔºàmessage-orientedÔºâ
- ÊîØÊåÅÂèØÈù†‰º†ËæìÔºàÁ±ª‰ºº TCPÔºâ

**üìå Â∏∏ËßÅ‰ΩøÁî®Âú∫ÊôØ**

- Áîµ‰ø°‰ø°‰ª§ÔºàSIGTRANÔºâ
- È´òÂèØÁî®ÊúçÂä°Âô®Èó¥ÈÄö‰ø°
- ÈúÄË¶Å‚ÄúÊ∂àÊÅØ + Â§öÊµÅ + ÂÜó‰Ωô‚ÄùÁöÑÁ≥ªÁªü

Áé∞‰ª£ LinuxÔºàÂÜÖÊ†∏ 3.x+ÔºâÈªòËÆ§ÊîØÊåÅ SCTPÔºàÈúÄÂä†ËΩΩÊ®°ÂùóÔºâ„ÄÇ

**üìå ‰ºòÁÇπ**

- **ÂèØÈù†‰º†Ëæì**ÔºàÂÉè TCPÔºâ
- **Èù¢ÂêëÊ∂àÊÅØ**ÔºàÂÉè UDPÔºâ
- **Â§öÊµÅ**ÔºöÈÅøÂÖç TCP ÁöÑÈòüÂ§¥ÈòªÂ°ûÔºàHead-of-Line BlockingÔºâ
- **Â§öÂÆø‰∏ª**ÔºöÈìæË∑ØÊïÖÈöúËá™Âä®ÂàáÊç¢ÔºàÈ´òÂèØÁî®Ôºâ

**üìå Áº∫ÁÇπ**

- ÊôÆÂèäÂ∫¶‰ΩéÔºåNAT/Èò≤ÁÅ´Â¢ôÂÖºÂÆπÊÄßÂ∑Æ
- ÁºñÁ®ã‰ΩøÁî®ÊØî TCP/UDP Â§çÊùÇ
- Ê≤°Êúâ TCP ÈÇ£Ê†∑ÊàêÁÜüÁöÑÁîüÊÄÅÂíå‰ºòÂåñ

| ÂçèËÆÆ     | Á±ªÂûã            | ÂèØÈù†ÊÄß   | È°∫Â∫è‰øùËØÅ     | Â§öÊµÅ | Â§öÂÆø‰∏ª | Âª∂Ëøü   | ÂÖ∏ÂûãÁî®ÈÄî                 |
| -------- | --------------- | -------- | ------------ | ---- | ------ | ------ | ------------------------ |
| **UDP**  | Êó†ËøûÊé•          | ‚ùå ‰∏çÂèØÈù† | ‚ùå            | ‚ùå    | ‚ùå      | ‚≠ê ÊúÄ‰Ωé | Ê∏∏Êàè„ÄÅÁõ¥Êí≠„ÄÅVoIP         |
| **TCP**  | Èù¢ÂêëËøûÊé•        | ‚úî        | ‚úî            | ‚ùå    | ‚ùå      | ‰∏≠     | Web„ÄÅÊñá‰ª∂‰º†Ëæì„ÄÅSSH       |
| **SCTP** | Èù¢ÂêëÊ∂àÊÅØ + ÂèØÈù† | ‚úî        | ÂèØ‰ª•Â§öÊµÅÁã¨Á´ã | ‚úî    | ‚úî      | ‰∏≠     | Áîµ‰ø°‰ø°‰ª§„ÄÅHA„ÄÅÊúçÂä°Èó¥ÈÄö‰ø° |

‰∏ÄËà¨Â∫îÁî®Â±ÇÂêë‰∏ã‰∫§‰∫í‰ΩøÁî®ÁöÑAPIÂ§ö‰∏∫Â•óÊé•Â≠óÊàñXTIÔºåËÆøÈóÆBPFÊàñDLPIÁöÑÊé•Âè£‰∏ç‰ΩøÁî®Â•óÊé•Â≠óÊàñXTI„ÄÇÔºà‰∏ÄÁßç‰æãÂ§ñÔºöLInux‰ΩøÁî®SOCK_PACKETÁöÑÁâπÊÆäÂ•óÊé•Â≠óÁ±ªÂûãÊèê‰æõÂØπ‰∏éÊï∞ÊçÆÈìæË∑ØÁöÑËÆøÈóÆÔºâ

~~~(Á©∫)
        Â∫îÁî®Â±ÇÂçèËÆÆ
    HTTP / DNS / RTP / ...
                ‚îÇ
                ‚ñº
       ‰º†ËæìÂ±ÇÂçèËÆÆ (L4)
   TCP ‚Üê‚Äî‚Äî‚Üí UDP ‚Üê‚Äî‚Äî‚Üí SCTP
      ‚îÇ          ‚îÇ
      ‚ñº          ‚ñº
       ÁΩëÁªúÂ±Ç (L3) Ê†∏ÂøÉÊâøËΩΩ
    +----------------------+
    |   IPv4   |   IPv6    |
    |----------+-----------|
    | ICMP     | ICMPv6    |
    | IGMP     | ND/SLAAC  |
    +----------------------+
        ‚îÇ            ‚îÇ
   (IPv4‰æùËµñARP)   (IPv6‰æùËµñND)
        ‚ñº            ‚ñº
+------------------------------+
| Êï∞ÊçÆÈìæË∑ØÂ±Ç (L2)               |
| ARP ‚Üî IPv4 Âú∞ÂùÄËß£Êûê           |
| RARP (Êóß)                    |
| DLPI (ÈìæË∑ØÂ±Ç API)             |
+------------------------------+
        ‚îÇ
        ‚ñº
+------------------------------+
| Áâ©ÁêÜÂ±Ç (L1): Áîµ„ÄÅÂÖâ„ÄÅÂ∞ÑÈ¢ëÁ≠â     |
+------------------------------+
         ‚ñ≤
         ‚îÇ
   BPF / eBPFÔºàË∑® L2-L4Ôºâ
   Packet ÊçïËé∑ / ËøáÊª§ / ËßÇÂØü

~~~



~~~diff
+----------------------------+
| Â∫îÁî®Â±Ç L7: HTTP, DNS, RTP |
+----------------------------+
| Ë°®Á§∫Â±Ç L6: TLS, Âä†Ëß£ÂØÜ       |
+----------------------------+
| ‰ºöËØùÂ±Ç L5: RPC, NetBIOS     |
+----------------------------+
| ‰º†ËæìÂ±Ç L4: TCP / UDP / SCTP |
+----------------------------+
| ÁΩëÁªúÂ±Ç L3: IPv4 IPv6 ICMP   |
|          IGMP ICMPv6 ND    |
+----------------------------+
| Êï∞ÊçÆÈìæË∑ØÂ±Ç L2: ARP RARP      |
|              DLPI          |
+----------------------------+
| Áâ©ÁêÜÂ±Ç L1: ÁîµÁºÜ ÂÖâÁ∫§ ‰ø°Âè∑     |
+----------------------------+
| BPF/eBPF: Ë∑® L2-L4 ËøáÊª§ÁõëÊéß  |
+----------------------------+

~~~



### 2.2 Áî®Êà∑Êï∞ÊçÆÊä•ÂçèËÆÆÔºàUDPÔºâ

Áï•

### 2.3 ‰º†ËæìÊéßÂà∂ÂçèËÆÆÔºàTCPÔºâ

Áï•

### 2.4 ÊµÅÊéßÂà∂‰º†ËæìÂçèËÆÆÔºàSCTPÔºâ

Áï•



### 2.5 TCPËøûÊé•ÁöÑÂª∫Á´ãÂíåÁªàÊ≠¢

#### 2.5.1 TCPËøûÊé•ÁöÑÂª∫Á´ã

TCPÁöÑ**Âª∫Á´ã**ÈúÄË¶ÅÈÄöËøá‚Äú‰∏âÊ¨°Êè°Êâã‚ÄùÔºåËøáÁ®ãÂ¶Ç‰∏ãÔºö

-----

1. **Á¨¨‰∏ÄÊ¨°Êè°Êâã**ÔºöÂÆ¢Êà∑Á´Ø ‚Üí ÊúçÂä°Âô®ÔºàSYNÔºâ

> * ÂÆ¢Êà∑Á´ØÂèëÈÄÅ‰∏Ä‰∏™ `SYN` ÂåÖÔºàÂêåÊ≠•Â∫èÂàóÂè∑Ôºâ
> * ÊåáÊòéÂÆ¢Êà∑Á´ØÁöÑÂàùÂßãÂ∫èÂàóÂè∑Ôºö`SEQ = x`
> * ÂÆ¢Êà∑Á´ØËøõÂÖ• **SYN_SENT** Áä∂ÊÄÅ

**‰ΩúÁî®Ôºö** ÂëäËØâÊúçÂä°Âô®‚ÄúÊàëË¶ÅËøûÊé•‰Ω†ÔºåÂπ∂‰ª•Â∫èÂè∑ x ‰Ωú‰∏∫Ëµ∑ÁÇπ‚Äù„ÄÇ

2. **Á¨¨‰∫åÊ¨°Êè°Êâã**ÔºöÊúçÂä°Âô® ‚Üí ÂÆ¢Êà∑Á´ØÔºàSYN + ACKÔºâ

> * ÊúçÂä°Âô®Êî∂Âà∞ SYN ÂêéÔºåÂõûÂ§çÔºö
>
>   - `SYN`ÔºàÂëäËØâÂÆ¢Êà∑Á´ØÔºöÊàë‰πüË¶ÅÂª∫Á´ãËøûÊé•Ôºâ
>
>   - `ACK`ÔºàÁ°ÆËÆ§ÂÆ¢Êà∑Á´ØÁöÑ SYNÔºâ
>
>     *  Á°ÆËÆ§Âè∑Ôºö`ACK = x + 1`
>*  ÊúçÂä°Âô®ÁöÑÂàùÂßãÂ∫èÂàóÂè∑Ôºö`SEQ = y`
> *  ÊúçÂä°Âô®ËøõÂÖ• **SYN_RCVD** Áä∂ÊÄÅ

**‰ΩúÁî®Ôºö**ÂëäËØâÂÆ¢Êà∑Á´Ø‚ÄúÊàëÊî∂Âà∞‰∫Ü‰Ω†ÁöÑËØ∑Ê±ÇÔºåÊàë‰πüÊÑøÊÑèÂª∫Á´ãËøûÊé•ÔºåÂ∫èÂè∑‰ªé y ÂºÄÂßã‚Äù„ÄÇ

3. **Á¨¨‰∏âÊ¨°Êè°Êâã**ÔºöÂÆ¢Êà∑Á´Ø ‚Üí ÊúçÂä°Âô®ÔºàACKÔºâ

> * ÂÆ¢Êà∑Á´ØÊî∂Âà∞ÊúçÂä°Âô®ÁöÑ SYN+ACK ÂêéÔºåÂõûÂ§çÔºö
>
>   - `ACK = y + 1`
>
>   - `SEQ = x + 1`
>
> * ÂÆ¢Êà∑Á´ØËøõÂÖ• **ESTABLISHED Â∑≤Âª∫Á´ãËøûÊé•**
>
> * ÊúçÂä°Âô®Êî∂Âà∞ ACK Âêé‰πüËøõÂÖ• **ESTABLISHED**

**‰ΩúÁî®Ôºö**ÂÆ¢Êà∑Á´ØÁ°ÆËÆ§‚ÄúËøûÊé•Âª∫Á´ãÊàêÂäü‚ÄùÔºåÊúçÂä°Âô®Êî∂Âà∞ÂêéÊ≠£ÂºèËøõÂÖ•ËøûÊé•Áä∂ÊÄÅ„ÄÇ

---------

**Â∏¶Áä∂ÊÄÅÁöÑÂèòÂåñÂõæ**Ôºö

~~~
           Client                                      Server
   ------------------                           -------------------
   Áä∂ÊÄÅ: CLOSED                                   Áä∂ÊÄÅ: LISTEN
        |                                               |
        | 1. SYN (SEQ=x)                                |
        |---------------------------------------------->|
        |                                               |
   Áä∂ÊÄÅ: SYN_SENT                                 Áä∂ÊÄÅ: SYN_RCVD
        | 2. SYN + ACK (SEQ=y, ACK=x+1)                 |
        |<----------------------------------------------|
        |                                               |
        | 3. ACK (ACK=y+1)                               |
        |---------------------------------------------->|
        |                                               |
   Áä∂ÊÄÅ: ESTABLISHED                             Áä∂ÊÄÅ: ESTABLISHED

~~~



#### 2.5.2 TCPËøûÊé•ÁöÑÁªàÊ≠¢

TCP ÊòØÂÖ®ÂèåÂ∑•ËøûÊé• ‚Äî‚Äî ÊØè‰∏ÄÊñπÈÉΩÂøÖÈ°ªÊòæÂºèÂÖ≥Èó≠Ëá™Â∑±ÁöÑÂèëÈÄÅÊñπÂêëÔºåÂõ†Ê≠§ÂÖ≥Èó≠ËøûÊé•ÈúÄË¶Å **ÂõõÊ¨°Êå•Êâã**„ÄÇ

----------

1.  **FINÔºà‰∏ªÂä®ÂÖ≥Èó≠Êñπ ‚Üí Ë¢´Âä®ÂÖ≥Èó≠ÊñπÔºâ**Ôºö‰∏ªÂä®ÂÖ≥Èó≠ÊñπÔºàÂ¶ÇÂÆ¢Êà∑Á´ØÔºâÂèëÈÄÅ

~~~(Á©∫)
FIN = 1, seq = u
~~~

Ë°®Á§∫ÔºöÊàëÂ∑≤ÁªèÊ≤°ÊúâÊï∞ÊçÆË¶ÅÂèë‰∫ÜÔºå‰ΩÜËøòËÉΩÊé•Êî∂Êï∞ÊçÆ„ÄÇË¢´Âä®ÂÖ≥Èó≠ÊñπËøõÂÖ• `CLOSE_WAIT` Áä∂ÊÄÅ„ÄÇ

2. **ACKÔºàË¢´Âä®ÂÖ≥Èó≠Êñπ ‚Üí ‰∏ªÂä®ÂÖ≥Èó≠ÊñπÔºâ**ÔºöË¢´Âä®ÂÖ≥Èó≠ÊñπÂõûÂ§ç

~~~(Á©∫)
ACK = 1, ack = u + 1
~~~

Ë°®Á§∫ÔºöÊàëÁü•ÈÅì‰Ω†Ë¶ÅÂÖ≥Èó≠ÂèëÈÄÅÊñπÂêë‰∫Ü„ÄÇ‰∏ªÂä®ÂÖ≥Èó≠ÊñπËøõÂÖ• `FIN_WAIT_2` Áä∂ÊÄÅ„ÄÇ

3. FINÔºàË¢´Âä®ÂÖ≥Èó≠Êñπ ‚Üí ‰∏ªÂä®ÂÖ≥Èó≠ÊñπÔºâÔºöÂΩìË¢´Âä®ÂÖ≥Èó≠ÊñπÊï∞ÊçÆÂèëÈÄÅÂÆåÊØïÂêéÔºå‰πüÂèëÈÄÅ

~~~(Á©∫)
FIN = 1, seq = v
~~~

Ë°®Á§∫ÔºöÊàëÊï∞ÊçÆÂèëÂÆå‰∫ÜÔºå‰πüË¶ÅÂÖ≥Èó≠‰∫Ü„ÄÇË¢´Âä®ÂÖ≥Èó≠ÊñπËøõÂÖ• `LAST_ACK` Áä∂ÊÄÅ„ÄÇ

4. ACKÔºà‰∏ªÂä®ÂÖ≥Èó≠Êñπ ‚Üí Ë¢´Âä®ÂÖ≥Èó≠ÊñπÔºâÔºö‰∏ªÂä®ÂÖ≥Èó≠ÊñπÂõûÂ§ç

~~~(Á©∫)
ACK = 1, ack = v + 1
~~~

‰∏ªÂä®ÂÖ≥Èó≠ÊñπËøõÂÖ• `TIME_WAIT`Ôºà‰øùÊåÅ 2MSLÔºâÔºå‰øùËØÅÂØπÊñπÊî∂Âà∞ ACK„ÄÇ

Ë¢´Âä®ÂÖ≥Èó≠ÊñπÊî∂Âà∞ ACK ÂêéËøõÂÖ• `CLOSED` Áä∂ÊÄÅ„ÄÇ

-----------------------

**Â∏¶Áä∂ÊÄÅÁöÑÂèòÂåñÂõæ**Ôºö

~~~(Á©∫)
‰∏ªÂä®ÂÖ≥Èó≠Êñπ (Client)                               Ë¢´Âä®ÂÖ≥Èó≠Êñπ (Server)
-----------------------                           ------------------------

    ESTABLISHED                                         ESTABLISHED
         |                                                    |
         | ----- FIN, seq=u --------------------------------> |
         |                                                    |
         | <---- ACK, ack=u+1 ------------------------------- |
         |                                                    |
    FIN_WAIT_2                                         CLOSE_WAIT
         |                                                    |
         |                          ÔºàServer ÁªßÁª≠ÂèëÈÄÅÊï∞ÊçÆÔºâ    |
         |                                                    |
         | <---- FIN, seq=v --------------------------------- |
         |                                                    |
         | ----- ACK, ack=v+1 ------------------------------> |
         |                                                    |
    TIME_WAIT                                            LAST_ACK
       (Á≠âÂæÖ 2MSL)                                            |
         |                                                    |
         |                                                    |
    CLOSED                                                CLOSED

~~~



#### 2.5.3 TCPÁä∂ÊÄÅËΩ¨ÁßªÂõæ

ËøôÊòØ TCP ÁöÑÊâÄÊúâÂÖ≥ÈîÆÁä∂ÊÄÅÔºö
 `CLOSED ‚Üí LISTEN ‚Üí SYN_RCVD ‚Üí ESTABLISHED ‚Üí FIN_WAIT_1 ‚Üí FIN_WAIT_2 ‚Üí TIME_WAIT ‚Üí CLOSED`
 ‰ª•ÂèäÊúçÂä°Âô®Á´ØÁöÑ `CLOSE_WAIT`„ÄÅ`LAST_ACK`„ÄÇ

TCP Áä∂ÊÄÅÊú∫Ôºö

~~~mermaid
%%{init: {'theme':'forest', 'wrap': true}}%%
stateDiagram-v2
    direction TB

    %% === Âª∫Á´ãÈò∂ÊÆµÔºàËìùËâ≤Ôºâ===
    [*] --> CLOSED
    CLOSED --> LISTEN: Passive Open
    CLOSED --> SYN_SENT: Active Open (send SYN)
    LISTEN --> SYN_RCVD: rcv SYN
    LISTEN --> SYN_SENT: send SYN (Simultaneous Open)
    SYN_SENT --> SYN_RCVD: rcv SYN
    SYN_SENT --> ESTABLISHED: rcv SYN+ACK<br>send ACK
    SYN_RCVD --> ESTABLISHED: rcv ACK

    %% === Êï∞ÊçÆÈò∂ÊÆµÔºàÁªøËâ≤Ôºâ===
    ESTABLISHED --> FIN_WAIT_1: close()<br>send FIN
    ESTABLISHED --> CLOSE_WAIT: rcv FIN<br>send ACK

    %% === ‰∏ªÂä®ÂÖ≥Èó≠Èò∂ÊÆµÔºàÊ©ôËâ≤Ôºâ===
    FIN_WAIT_1 --> FIN_WAIT_2: rcv ACK
    FIN_WAIT_1 --> CLOSING: rcv FIN+ACK
    FIN_WAIT_2 --> TIME_WAIT: rcv FIN<br>send ACK
    CLOSING --> TIME_WAIT: rcv ACK
    TIME_WAIT --> CLOSED: timeout (2MSL)

    %% === Ë¢´Âä®ÂÖ≥Èó≠Èò∂ÊÆµÔºàÁ∫¢Ëâ≤Ôºâ===
    CLOSE_WAIT --> LAST_ACK: send FIN
    LAST_ACK --> CLOSED: rcv ACK

    %% === Ê†∑Âºè ===
    style CLOSED fill:#ffffff,stroke:#333,color:#000
    style LISTEN fill:#a0c4ff,stroke:#333,color:#000
    style SYN_SENT fill:#a0c4ff,stroke:#333,color:#000
    style SYN_RCVD fill:#a0c4ff,stroke:#333,color:#000
    style ESTABLISHED fill:#32cd32,stroke:#333,color:#000
    style FIN_WAIT_1 fill:#ffa500,stroke:#333,color:#000
    style FIN_WAIT_2 fill:#ffa500,stroke:#333,color:#000
    style CLOSING fill:#ffa500,stroke:#333,color:#000
    style TIME_WAIT fill:#ffa500,stroke:#333,color:#000
    style CLOSE_WAIT fill:#ff6347,stroke:#333,color:#000
    style LAST_ACK fill:#ff6347,stroke:#333,color:#000

~~~

ÂõæÁ§∫Ôºö

![](./images/TCP%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%E5%9B%BE.png)

